/*!
 * Tiny Advanced Code Editor plugin
 *
 * Copyright (c) 2023 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 3.3.1-98
 */

!function(){"use strict";const e=e=>t=>typeof t===e,t=e=>"string"===(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&(r=o=e,(n=String).prototype.isPrototypeOf(r)||(null===(s=o.constructor)||void 0===s?void 0:s.name)===n.name)?"string":t;var r,o,n,s})(e),r=e("boolean"),o=e=>!(e=>null==e)(e),n=e("function"),s=e("number"),i=()=>{};class a{constructor(e,t){this.tag=e,this.value=t}static some(e){return new a(!0,e)}static none(){return a.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?a.some(e(this.value)):a.none()}bind(e){return this.tag?e(this.value):a.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:a.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return o(e)?a.some(e):a.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}a.singletonNone=new a(!1);const l=(e,t)=>{for(let r=0,o=e.length;r<o;r++)if(t(e[r],r))return!0;return!1},u=Object.hasOwnProperty;"undefined"!=typeof window?window:Function("return this;")();const d=e=>t=>(e=>e.dom.nodeType)(t)===e,c=d(1),m=d(3),g=d(9),h=d(11),p=(e,o)=>((e,o,n)=>{const i=((e,t)=>{const r=((e,t)=>{const r=e.dom.getAttribute(t);return null===r?void 0:r})(e,t);return void 0===r||""===r?[]:r.split(" ")})(e,o);return((e,o,n)=>{((e,o,n)=>{if(!(t(n)||r(n)||s(n)))throw console.error("Invalid call to Attribute.set. Key ",o,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(o,n+"")})(e.dom,o,n)})(e,o,i.concat([n]).join(" ")),!0})(e,"class",o),v=e=>void 0!==e.style&&n(e.style.getPropertyValue),y=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},f=(e,t)=>{const r=(t||document).createElement(e);return y(r)},w=y,S=e=>g(e)?e:w(e.dom.ownerDocument),b=e=>h(e)&&o(e.dom.host),C=n(Element.prototype.attachShadow)&&n(Node.prototype.getRootNode)?e=>w(e.dom.getRootNode()):S,E=e=>w(e.dom.host),A=e=>{const t=m(e)?e.dom.parentNode:e.dom;if(null==t||null===t.ownerDocument)return!1;const r=t.ownerDocument;return(e=>{const t=C(e);return b(t)?a.some(t):a.none()})(w(t)).fold((()=>r.body.contains(t)),(o=A,n=E,e=>o(n(e))));var o,n},I=()=>O(w(document)),O=e=>{const t=e.dom.body;if(null==t)throw new Error("Body is not available yet");return w(t)},N=e=>{return(t=tinymce,"get",((e,t)=>u.call(e,t))(t,"get")?a.from(t.get):a.none()).bind((t=>a.from(t.call(tinymce,e))));var t},T={unsupportedLength:["em","ex","cap","ch","ic","rem","lh","rlh","vw","vh","vi","vb","vmin","vmax","cm","mm","Q","in","pc","pt","px"],fixed:["px","pt"],relative:["%"],empty:[""]},L=(()=>{const e="[0-9]+",t="[eE][+-]?"+e,r=e=>`(?:${e})?`,o=["Infinity",e+"\\."+r(e)+r(t),"\\."+e+r(t),e+r(t)].join("|");return new RegExp(`^([+-]?(?:${o}))(.*)$`)})(),P=(e,t,r,o="",n)=>{const s=(e=>{const t=N(e).map((e=>{const t=C(w(e.getElement()));return b(r=t)?r:w(S(r).dom.body);var r})).getOrThunk(I);if(c(t))return{element:t,destroy:i};{const e=f("div");return((e,t)=>{e.dom.appendChild(t.dom)})(t,e),{element:e,destroy:()=>(e=>{const t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)})(e)}}})(r.editorId),u=((e,t)=>{const r=(r,o)=>(o&&!o()||setTimeout((()=>{r.state.completionActive||r.showHint({completeSingle:!1,container:t})}),100),e.Pass);return{completeAfter:r,completeIfAfterLt:t=>r(t,(()=>{const r=t.getCursor();return"<"===t.getRange(e.Pos(r.line,r.ch-1),r)})),completeIfInTag:t=>r(t,(()=>{const r=t.getTokenAt(t.getCursor());return!!("string"!==r.type||/['"]/.test(r.string.charAt(r.string.length-1))&&1!==r.string.length)&&e.innerMode(t.getMode(),r.state).state.tagName}))}})(e,s.element.dom),d="dracula",m={lineWrapping:r.lineWrapping,lineNumbers:r.lineNumbers,foldGutter:r.foldGutter,theme:n.dark?d:r.theme,direction:r.direction,matchTags:{bothTags:!0},keyMap:"sublime",gutters:r.gutter?["CodeMirror-linenumbers","CodeMirror-foldgutter"]:[],extraKeys:{"Alt-F":"findPersistent","Ctrl-J":"toMatchingTag","Ctrl-B":"selectNextOccurrence","'<'":u.completeAfter,"'/'":u.completeIfAfterLt,"' '":u.completeIfInTag,"'='":u.completeIfInTag,"Ctrl-Q":e=>{e.foldCode(e.getCursor())}},mode:"text/html",value:o},g=e(t,m),h=e=>{27!==e.keyCode&&e.stopPropagation()};t.addEventListener("keyup",h),t.addEventListener("keydown",h),t.addEventListener("keypress",h),setTimeout((()=>{g.focus(),r.cursor&&g.doc.setCursor(r.cursor)}),0),setTimeout((()=>g.refresh()),200);const p=e=>{const t=g.getWrapperElement();e.fold((()=>{var e,r;t.classList.remove("inherit-font-size"),null===(r=null===(e=t.parentElement)||void 0===e?void 0:e.style)||void 0===r||r.removeProperty("font-size")}),(e=>{var r,o;t.classList.add("inherit-font-size"),null===(o=null===(r=t.parentElement)||void 0===r?void 0:r.style)||void 0===o||o.setProperty("font-size",e)})),g.refresh()},y={getValue:()=>g.doc.getValue(),setValue:e=>g.doc.setValue(e),setDarkMode:e=>{e?g.setOption("theme",d):g.setOption("theme",r.theme)},copyCode:()=>new Promise(((e,t)=>window.isSecureContext?e(navigator.clipboard.writeText(g.getValue())):t("context is not secure"))),setFontSize:p,changeFontSize:e=>{const t=g.getWrapperElement(),r=(d=w(t),c=".CodeMirror-scroll",((e,t)=>{const r=void 0===t?document:t.dom;return 1!==(o=r).nodeType&&9!==o.nodeType&&11!==o.nodeType||0===o.childElementCount?a.none():a.from(r.querySelector(e)).map(w);var o})(c,d)).map((e=>((e,t)=>{const r=e.dom,o=window.getComputedStyle(r).getPropertyValue(t);return""!==o||A(e)?o:((e,t)=>v(e)?e.style.getPropertyValue(t):"")(r,t)})(e,"font-size"))).getOr("0px"),o=(i=r,u=["unsupportedLength"],a.from(L.exec(i)).bind((e=>{const t=Number(e[1]),r=e[2];return((e,t)=>l(t,(t=>l(T[t],(t=>e===t)))))(r,u)?a.some({value:t,unit:r}):a.none()}))),n=o.map((e=>e.value)).getOr(0),s=o.map((e=>e.unit)).getOr("");var i,u,d,c;let m=a.none();return"increase"===e&&(m=a.some(`${n+1}${s}`)),"decrease"===e&&(m=a.some(`${n>5?n-1:n}${s}`)),p(m),m},destroy:()=>{var e,o;t.removeEventListener("keyup",h),t.removeEventListener("keydown",h),t.removeEventListener("keypress",h),e=r.editorId,o=r.advcodeInstanceId,N(e).bind((e=>a.from(e.plugins.advcode))).each((e=>{e[o]&&delete e[o]})),s.destroy()}};return y},k={},M=(e,t)=>{if(k[t])return Promise.resolve();{const n=N(t),s=n.bind((e=>{var t;return a.from(null===(t=e.ui)||void 0===t?void 0:t.styleSheetLoader)})).getOr(tinymce.DOM.styleSheetLoader);return n.each((r=>{r.on("remove",(()=>{s.unload(e),delete k[t]}))})),k[t]=!0,r=e,(null!=(o=s)?o:tinymce.DOM.styleSheetLoader).load(r)}var r,o};tinymce.Resource.add("tinymce.plugins.advcode.customeditor",((e,r)=>new Promise((o=>{const n=w(e);var s;((e,r,o)=>{((e,r,o)=>{if(!t(o))throw console.error("Invalid call to CSS.set. Property ",r,":: Value ",o,":: Element ",e),new Error("CSS value must be a string: "+o);v(e)&&e.style.setProperty(r,o)})(e.dom,r,o)})(n,"width","100%"),(s=n,a.from(s.dom.parentNode).map(w)).filter(c).each((e=>((e,t)=>{(e=>void 0!==e.dom.classList)(e)?e.dom.classList.add(t):p(e,t)})(e,"mce-codemirror")));const l=(u=r.codeMirrorScriptUrl,d=r.codeMirrorCssUrl,m=r.editorId,g=r.currentAdvStatus,Promise.all([M(d,m),("tinymce.plugins.advcode.CodeMirror",h=u,tinymce.Resource.load("tinymce.plugins.advcode.CodeMirror",h))]).then((([e,t])=>(e,r,o)=>P(t(),e,r,o,g)))).then((t=>{const{setValue:o,getValue:n,copyCode:s,setDarkMode:l,changeFontSize:u,setFontSize:d,destroy:c}=t(e,r,"",r.currentAdvStatus),m={getValue:n,setValue:o,destroy:c};return r.currentAdvStatus.fontSize.fold(i,(()=>d(r.currentAdvStatus.fontSize))),((e,t)=>N(e).bind((e=>a.from(e.plugins.advcode))).map((e=>(e[t]||(e[t]=(()=>{const e=(e=>{const t=(e=>{let t=e;return{get:()=>t,set:e=>{t=e}}})(a.none()),r=()=>t.get().each(e);return{clear:()=>{r(),t.set(a.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{r(),t.set(a.some(e))}}})(i);return{...e,on:t=>e.get().each(t)}})()),e[t]))))(r.editorId,r.advcodeInstanceId).each((e=>e.set({copyCode:s,changeFontSize:u,setFontSize:d,setDarkMode:l}))),m}));var u,d,m,g,h;o(l)}))))}();